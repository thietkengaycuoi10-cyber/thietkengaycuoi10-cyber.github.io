<!DOCTYPE html>
<html lang="vi" class="h-full antialiased">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ZALO: 0352803379 - STUDIO V35.75 (WEB VERSION)</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400;700&family=Playfair+Display:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
        // H·ªÜ TH·ªêNG B·∫¢O V·ªÜ B·∫¢N QUY·ªÄN - ANTI-THEFT SYSTEM
        (function() {
            document.addEventListener('contextmenu', function(e) { e.preventDefault(); return false; });
            document.onkeydown = function(e) {
                if (e.keyCode == 123) return false;
                if (e.ctrlKey && e.shiftKey && (e.keyCode == 'I'.charCodeAt(0) || e.keyCode == 'C'.charCodeAt(0) || e.keyCode == 'J'.charCodeAt(0))) return false;
                if (e.ctrlKey && e.keyCode == 'U'.charCodeAt(0)) return false;
                if (e.ctrlKey && e.keyCode == 'S'.charCodeAt(0)) { e.preventDefault(); return false; }
            };
            console.log("%cSTUDIO V35.75", "color: red; font-size: 30px; font-weight: bold;");
        })();
    </script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { 
                        sans: ['"Plus Jakarta Sans"', 'sans-serif'],
                        body: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                        serif: ['"Playfair Display"', 'serif']
                    },
                    colors: {
                        glass: { 100: 'rgba(255, 255, 255, 0.05)', 200: 'rgba(255, 255, 255, 0.1)' },
                        pro: { 500: '#3b82f6', 600: '#2563eb', gold: '#f59e0b', cine: '#ec4899', smart: '#10b981', flux: '#8b5cf6', danger: '#f43f5e', cyan: '#06b6d4', real: '#f97316', ancient: '#8b4513' }
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'blob': 'blob 7s infinite',
                        'scan': 'scan 2s linear infinite',
                        'toast-in': 'toastIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)', 
                        'pulse-glow': 'pulseGlow 2s infinite',
                        'flux-pulse': 'fluxPulse 3s infinite',
                        'real-pulse': 'realPulse 3s infinite',
                        'fade-out': 'fadeOut 0.5s ease-out forwards',
                        'enter-up': 'enterUp 0.6s cubic-bezier(0.22, 1, 0.36, 1) forwards',
                    },
                    keyframes: {
                        enterUp: { '0%': { opacity: '0', transform: 'translateY(20px) scale(0.95)' }, '100%': { opacity: '1', transform: 'translateY(0) scale(1)' } },
                        float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-10px)' } },
                        blob: { '0%': { transform: 'translate(0px, 0px) scale(1)' }, '33%': { transform: 'translate(30px, -50px) scale(1.1)' }, '66%': { transform: 'translate(-20px, 20px) scale(0.9)' }, '100%': { transform: 'translate(0px, 0px) scale(1)' } },
                        scan: { '0%': { top: '0%', opacity: '0' }, '10%': { opacity: '1' }, '90%': { opacity: '1' }, '100%': { top: '100%', opacity: '0' } },
                        toastIn: { '0%': { transform: 'translateY(20px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } },
                        pulseGlow: { '0%, 100%': { opacity: '1', boxShadow: '0 0 10px #10b981' }, '50%': { opacity: '0.8', boxShadow: '0 0 20px #10b981' } },
                        fluxPulse: { '0%, 100%': { boxShadow: '0 0 5px #8b5cf6' }, '50%': { boxShadow: '0 0 15px #8b5cf6' } },
                        realPulse: { '0%, 100%': { boxShadow: '0 0 5px #f97316' }, '50%': { boxShadow: '0 0 15px #f97316' } },
                        fadeOut: { '0%': { opacity: '1', visibility: 'visible' }, '100%': { opacity: '0', visibility: 'hidden' } }
                    }
                }
            }
        }
    </script>

    <style>
        :root { --ease-spring: cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        body { background-color: #050505; background-image: radial-gradient(circle at top right, #0f172a, #050505); color: #e2e8f0; -webkit-user-select: none; user-select: none; }
        input, textarea { -webkit-user-select: text; user-select: text; }
        .bg-blob { position: absolute; border-radius: 50%; filter: blur(100px); opacity: 0.15; z-index: 0; animation: blob 15s infinite; }
        .blob-1 { top: -10%; left: -10%; width: 500px; height: 500px; background: #8b5cf6; } 
        .blob-2 { bottom: -10%; right: -10%; width: 500px; height: 500px; background: #3b82f6; animation-delay: 2s; }
        ::-webkit-scrollbar { width: 5px; } ::-webkit-scrollbar-track { background: transparent; } ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 20px; }
        .glass-panel { background: rgba(10, 11, 15, 0.95); backdrop-filter: blur(20px); border-right: 1px solid rgba(255, 255, 255, 0.08); box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5); }
        .pro-input { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.08); color: #cbd5e1; transition: all 0.2s; font-size: 11px; border-radius: 6px; padding-left: 10px; }
        .pro-input:focus { background: rgba(255, 255, 255, 0.06); border-color: #8b5cf6; outline: none; }
        select { color-scheme: dark; } select option { background-color: #0f172a; color: #e2e8f0; padding: 12px; } select optgroup { background-color: #020617; color: #94a3b8; font-weight: 700; }
        .module-group { border: 1px solid rgba(255, 255, 255, 0.05); background: rgba(255, 255, 255, 0.01); border-radius: 8px; margin-bottom: 6px; overflow: hidden; }
        .module-header { background: rgba(255, 255, 255, 0.02); transition: background 0.2s; padding: 10px 12px; }
        .module-header:hover { background: rgba(255, 255, 255, 0.04); }
        .module-content { display: grid; grid-template-rows: 0fr; transition: grid-template-rows 0.3s ease, opacity 0.3s ease; opacity: 0; }
        .module-content.open { grid-template-rows: 1fr; opacity: 1; }
        .module-content.open .module-inner { padding: 10px 12px; }
        .module-inner { min-height: 0; overflow: hidden; }
        .chk-pro { appearance: none; width: 14px; height: 14px; border-radius: 3px; border: 1px solid rgba(148, 163, 184, 0.4); background: transparent; display: grid; place-content: center; cursor: pointer; transition: all 0.2s; }
        .chk-pro::before { content: ""; width: 8px; height: 8px; transform: scale(0); background: #e2e8f0; border-radius: 2px; transition: transform 0.2s; }
        .chk-pro:checked::before { transform: scale(1); }
        .chk-pro:checked { border-color: #8b5cf6; background: #8b5cf6; }
        .chk-red:checked { border-color: #ef4444; background: #ef4444; }
        .slider-flux::-webkit-slider-thumb { background: #8b5cf6; box-shadow: 0 0 10px #8b5cf6; }
        .btn-flux-modern { background: linear-gradient(135deg, #6d28d9 0%, #8b5cf6 100%); border: 1px solid rgba(139, 92, 246, 0.3); color: white; box-shadow: 0 0 15px rgba(139, 92, 246, 0.3); }
        .btn-flux-modern:hover { transform: translateY(-1px); box-shadow: 0 0 25px rgba(139, 92, 246, 0.5); }
        .btn-gold-modern { background: linear-gradient(135deg, #b45309 0%, #f59e0b 100%); border: 1px solid rgba(255,215,0,0.3); color: white; }
        .shimmer-text { background: linear-gradient(90deg, #fff 0%, #a78bfa 50%, #fff 100%); background-size: 200% auto; -webkit-background-clip: text; -webkit-text-fill-color: transparent; animation: shine 3s linear infinite; }
        @keyframes shine { to { background-position: 200% center; } }
        .modal-fade-in { animation: modalFadeIn 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes modalFadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
    </style>
</head>

<body class="text-slate-300 font-sans h-screen flex overflow-hidden select-none relative" oncontextmenu="return false;">
    
    <div id="security-gate" class="fixed inset-0 z-[9999] flex items-center justify-center bg-[#050505]/90 backdrop-blur-3xl transition-opacity duration-500">
        <div class="relative z-10 w-full max-w-[400px] bg-white/[0.02] border border-white/5 rounded-3xl p-8 shadow-2xl animate-enter-up flex flex-col items-center">
            <button id="gate-admin-key" class="absolute top-4 right-4 text-slate-600 hover:text-white transition-colors p-2 z-50 rounded-full hover:bg-white/5"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"></path></svg></button>
            <div class="flex flex-col items-center mb-8">
                <div class="w-16 h-16 rounded-2xl bg-gradient-to-tr from-violet-600 to-blue-600 p-[1px] mb-4 shadow-lg shadow-violet-500/20 rotate-3 hover:rotate-0 transition-transform duration-500 cursor-pointer group">
                     <div class="w-full h-full rounded-2xl bg-[#0a0a0f] flex items-center justify-center relative overflow-hidden group-hover:bg-opacity-80 transition-all">
                         <div class="absolute inset-0 bg-violet-500/20 animate-pulse"></div>
                         <svg class="w-8 h-8 text-white relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                     </div>
                </div>
                <h1 class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-white via-slate-200 to-slate-400 tracking-tight mb-1">PH·ª§C CH·∫æ ·∫¢NH</h1>
                <div class="flex items-center gap-2 opacity-70">
                    <div class="h-[1px] w-8 bg-gradient-to-r from-transparent to-violet-500"></div>
                    <p class="text-[10px] text-violet-300 font-mono tracking-[0.3em] uppercase">Professional AI</p>
                    <div class="h-[1px] w-8 bg-gradient-to-l from-transparent to-violet-500"></div>
                </div>
            </div>
            <div class="w-full space-y-4">
                <div class="relative group w-full">
                    <div class="absolute -inset-0.5 bg-gradient-to-r from-violet-600 to-blue-600 rounded-2xl blur opacity-10 group-hover:opacity-30 transition duration-500"></div>
                    <div class="relative bg-black/40 border border-white/10 rounded-2xl p-4 flex flex-col items-center justify-center transition-all group-hover:border-white/20">
                        <span class="text-[9px] text-slate-500 uppercase tracking-widest font-bold mb-1.5">THI·∫æT B·ªä TRUY C·∫¨P</span>
                        <div class="flex items-center gap-2 h-8">
                            <span id="gate-ip-display" class="font-mono text-sm font-bold text-white tracking-wider shimmer-text">ƒêang k·∫øt n·ªëi...</span>
                            <div id="gate-loading-spinner" class="w-3 h-3 border-2 border-white/20 border-t-white rounded-full animate-spin"></div>
                        </div>
                    </div>
                </div>
                <button id="gate-submit" class="w-full py-3.5 bg-gradient-to-r from-indigo-100 to-violet-100 text-slate-900 hover:to-white rounded-xl text-xs font-bold tracking-[0.15em] transition-all active:scale-[0.98] shadow-[0_0_20px_rgba(255,255,255,0.1)] flex items-center justify-center gap-2 group disabled:opacity-50 disabled:cursor-not-allowed overflow-hidden relative" disabled>
                    <span class="relative z-10">V√ÄO PH·ª§C CH·∫æ ·∫¢NH</span>
                    <svg class="w-3.5 h-3.5 relative z-10 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
                </button>
            </div>
            <div class="mt-6 h-4 flex items-center justify-center">
                <p id="gate-status" class="text-[10px] text-slate-500 transition-colors animate-pulse">ƒêang qu√©t th√¥ng tin thi·∫øt b·ªã...</p>
            </div>
             <div class="absolute bottom-4 left-0 right-0 text-center opacity-30 pointer-events-none">
                <p class="text-[8px] font-mono">SECURE GATEWAY ‚Ä¢ IP VERIFICATION</p>
            </div>
        </div>
    </div>

    <div class="bg-blob blob-1"></div><div class="bg-blob blob-2"></div>
    <div id="toast-container" class="fixed top-6 right-6 z-[100] flex flex-col gap-3 pointer-events-none"></div>
    
    <div class="flex w-full h-full relative z-10 backdrop-blur-[1px]" id="fullscreen-target">
        <aside id="sidebar" class="w-[360px] flex-shrink-0 glass-panel mobile-sidebar-bg flex flex-col transition-transform duration-500 ease-[cubic-bezier(0.33,1,0.68,1)] absolute z-50 h-full lg:relative lg:translate-x-0 -translate-x-full">
            <div class="h-14 px-4 flex items-center justify-between border-b border-white/5 bg-white/[0.02]">
                <div class="flex flex-col">
                    <h1 class="text-xs font-bold tracking-widest text-violet-500">PH·ª§C CH·∫æ ·∫¢NH</h1>
                    <div class="flex items-center gap-2">
                        <span id="top-bar-ip" class="text-[9px] text-slate-400 font-mono">IP: Loading...</span>
                        <span class="w-1 h-1 rounded-full bg-violet-500"></span>
                        <span class="text-[9px] text-violet-400 font-bold">V35.75 (IP LOGIN)</span>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <div class="flex flex-col items-end mr-1" id="credit-display">
                        <span class="text-[8px] text-slate-400 font-bold uppercase tracking-wider">CREDITS</span>
                        <span class="text-xs font-mono font-bold text-yellow-400 shadow-[0_0_10px_rgba(250,204,21,0.3)]" id="credit-count">---</span>
                    </div>
                    <button id="close-sidebar-mobile" class="lg:hidden text-slate-400 p-2"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 18L18 6M6 6l12 12"></path></svg></button>
                </div>
            </div>

            <div class="flex-1 overflow-y-auto p-4 scroll-smooth custom-scrollbar space-y-2">
                <div class="relative group">
                    <input type="file" id="image-upload" accept="image/*" style="position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); border:0;">
                    <label id="drop-zone" for="image-upload" class="flex flex-col items-center justify-center w-full h-28 border border-dashed border-violet-500/50 rounded-lg cursor-pointer bg-white/[0.02] hover:bg-violet-900/[0.1] hover:border-violet-500 transition-all duration-200">
                        <div id="upload-placeholder" class="flex flex-col items-center pointer-events-none">
                            <svg class="w-5 h-5 text-violet-500 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l-1.586-1.586a2 2 0 00-2.828 0L6 18H4a2 2 0 01-2-2V6a2 2 0 01-2-2V6a2 2 0 012-2h16a2 2 0 012 2v8a2 2 0 01-2 2h-2m-4-4l-3 3m0 0l-3-3m3 3V4"></path></svg>
                            <span class="text-[10px] font-bold text-slate-400 uppercase">T·∫£i ·∫£nh g·ªëc (K√©o th·∫£ ho·∫∑c B·∫•m v√†o)</span>
                        </div>
                    </label>
                </div>

                <button id="btn-auto-pilot" class="w-full py-2.5 mb-3 btn-flux-modern text-white rounded-lg flex items-center justify-center gap-2 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-[0_0_15px_rgba(139,92,246,0.2)]">
                    <svg class="w-4 h-4 animate-pulse" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path></svg>
                    <span class="text-[10px] font-bold tracking-widest">AUTO SCAN V35.60 (AUTO-SIZE)</span>
                </button>

                <div class="relative group p-2 rounded-lg border border-violet-500/30 bg-violet-500/5 mb-3 animate-flux-pulse" id="kontext-module-container">
                    <div class="flex items-center gap-2 mb-2">
                         <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="mode-flux" class="sr-only peer" checked>
                            <div class="w-9 h-5 bg-slate-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-violet-500"></div>
                        </label>
                        <div class="flex-1">
                            <span class="block text-[10px] font-bold text-violet-400 tracking-wide">üöÄ FLUX / REALVIS ENGINE</span>
                            <span class="block text-[9px] text-violet-500/70">Core: Kontext, SUPIR, ReActor</span>
                        </div>
                    </div>
                    <div class="pl-11 pr-1 border-t border-violet-500/20 pt-2" id="workflow-container">
                        <label class="block text-[9px] font-bold text-violet-300 mb-1">CH·ªåN QUY TR√åNH</label>
                        <select id="kontext-workflow" class="pro-input w-full py-1.5 cursor-pointer bg-violet-900/20 border-violet-500/30 text-violet-200">
                            <option value="default">‚ú® M·∫∑c ƒë·ªãnh (Kontext Base)</option>
                            <option value="replica_pro" class="text-yellow-400 font-bold">üß¨ SI√äU TH·ª∞C (REPLICA PRO)</option>
                            <option value="ancient_restore" class="text-purple-400 font-bold">üèØ Ph·ª•c ch·∫ø Tranh C·ªï</option>
                            <option value="realvis_v5" class="text-orange-400 font-bold">ü¶Å RealVisXL V5</option>
                            <option value="qwen_restore_full" class="text-cyan-400 font-bold">‚ö° Qwen V2.5 Full</option>
                        </select>
                         <div class="text-[8px] text-violet-400/60 mt-1 italic" id="workflow-desc">S·ª≠ d·ª•ng OldPhoto-2.safetensors (0.87)</div>
                    </div>
                </div>

                <div class="module-group border-yellow-500/30" id="module-military">
                    <button id="toggle-military" class="w-full flex justify-between items-center module-header bg-yellow-500/10 hover:bg-yellow-500/20">
                        <span class="text-[10px] font-bold text-yellow-500 tracking-wide uppercase flex items-center gap-2">üáªüá≥ QU√ÇN S·ª¨ & K·ª∂ V·∫¨T</span>
                        <svg class="w-3 h-3 text-yellow-500 toggle-icon" id="icon-military" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                    <div id="content-military" class="module-content">
                        <div class="module-inner space-y-2">
                             <select id="mil-branch" class="pro-input w-full py-1.5"><option value="">-- Qu√¢n ch·ªßng --</option><option value="vietnamese army ground force">L·ª•c qu√¢n</option><option value="vietnamese public security">C√¥ng an</option></select>
                             <select id="mil-uniform" class="pro-input w-full py-1.5"><option value="">-- Qu√¢n ph·ª•c --</option><option value="wearing to chau uniform">T√¥ Ch√¢u (Ch·ªëng M·ªπ)</option><option value="wearing K82 uniform">K82</option></select>
                             <div class="flex items-center gap-2"><input id="check-sao-vang" type="checkbox" class="chk-pro"><label for="check-sao-vang" class="text-[9px] text-yellow-400">Hu√¢n ch∆∞∆°ng Sao V√†ng</label></div>
                             <div class="flex items-center gap-2"><input id="check-insignia-boost" type="checkbox" class="chk-pro"><label for="check-insignia-boost" class="text-[9px] text-yellow-300">TƒÉng n√©t Qu√¢n h√†m</label></div>
                        </div>
                    </div>
                </div>

                <div class="module-group" id="module-prompt">
                    <button id="toggle-prompt" class="w-full flex justify-between items-center module-header">
                        <span class="text-[10px] font-bold text-slate-200 tracking-wide uppercase flex items-center gap-2">üìù PROMPT & API</span>
                        <svg class="w-3 h-3 text-slate-600 toggle-icon" id="icon-prompt" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                    <div id="content-prompt" class="module-content">
                        <div class="module-inner">
                            <textarea id="prompt-main" rows="3" class="pro-input w-full p-2 resize-none text-[10px] font-mono mb-2" placeholder="H·ªá th·ªëng t·ª± ƒë·ªông t·ªëi ∆∞u..."></textarea>
                            <input type="text" id="prompt-negative" placeholder="Negative prompt..." class="pro-input w-full py-1.5 mb-2">
                            <input type="password" id="user-api-key" placeholder="Nh·∫≠p API Key c·ªßa b·∫°n (Google/Comet)..." class="pro-input w-full py-1.5 text-yellow-400 border-yellow-500/30">
                        </div>
                    </div>
                </div>

            </div>

            <div class="p-4 glass-panel border-t-0 space-y-2 z-20">
                <button id="process-image" class="w-full py-3 btn-flux-modern text-white font-bold text-xs tracking-widest flex justify-center items-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                    T·∫†O ·∫¢NH (FLUX KONTEXT)
                </button>
                <button id="reset-button" class="w-full py-2 bg-white/5 hover:bg-white/10 text-slate-400 text-[10px] font-bold tracking-widest rounded transition-colors border border-white/5">L√ÄM M·ªöI</button>
            </div>
        </aside>

        <main class="flex-1 flex flex-col relative overflow-hidden" id="main-workspace">
             <div class="lg:hidden h-14 glass-panel border-b border-white/5 flex items-center px-4 justify-between z-30 relative bg-[#0a0a0f]/90 backdrop-blur-xl">
                <button id="toggle-sidebar-btn" class="text-slate-400 p-2 border border-white/10 rounded-lg hover:bg-white/5"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg></button>
                <div class="flex flex-col items-center">
                     <span class="font-bold text-violet-500 text-xs tracking-wider">STUDIO V35.75</span>
                     <span class="text-[8px] text-slate-500 font-mono tracking-widest" id="mobile-status-text">WAITING FOR IMAGE</span>
                </div>
                <button id="download-mobile" class="text-blue-400 p-2 bg-blue-500/10 rounded-lg border border-blue-500/20 disabled:opacity-30" disabled><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg></button>
            </div>

            <div class="absolute top-6 left-6 right-6 h-12 glass-panel rounded-lg flex items-center justify-between px-4 z-20 shadow-lg hidden sm:flex border border-white/5">
                <div class="flex items-center gap-3">
                     <div class="text-[10px] text-slate-400 font-mono flex items-center gap-2"><span class="w-1.5 h-1.5 rounded-full bg-violet-500"></span>ZOOM: <span id="zoom-level" class="text-white font-bold">100%</span></div>
                </div>
                <div class="flex items-center gap-3">
                    <button id="download-trigger" class="flex items-center gap-2 bg-blue-600 hover:bg-blue-500 text-white px-5 py-2 rounded text-xs font-bold transition-all opacity-50 cursor-not-allowed shadow-lg" disabled><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg><span>L∆ØU ·∫¢NH</span></button>
                </div>
            </div>
            
            <div class="flex-1 relative flex items-center justify-center overflow-hidden perspective-1000">
                <div id="canvas-scale-container" class="relative transition-transform duration-500 ease-[cubic-bezier(0.19,1,0.22,1)] origin-center will-change-transform" style="transform: scale(1);">
                    <div id="scan-beam" class="scan-beam"></div>
                    
                    <div id="comparison-view" class="relative max-w-[95vw] max-h-[80vh] flex justify-center items-center" style="display:none;">
                         <div id="comp-inner" class="relative shadow-2xl rounded overflow-hidden cursor-ew-resize group select-none border border-white/10 bg-black">
                              <img id="img-original" class="block max-h-[75vh] w-auto pointer-events-none select-none">
                              <div id="img-modified-wrapper" class="absolute top-0 left-0 h-full w-[50%] overflow-hidden border-r border-white/50 bg-black/5">
                                  <img id="img-modified" class="absolute top-0 left-0 max-h-[75vh] w-auto pointer-events-none select-none" style="max-width: none;">
                              </div>
                              <div id="slider-handle" class="absolute top-0 bottom-0 left-[50%] w-0.5 bg-white/80 z-20 pointer-events-none shadow-[0_0_10px_rgba(0,0,0,0.5)]"></div>
                         </div>
                    </div>

                    <div id="ai-terminal-overlay" class="absolute inset-0 z-50 bg-[#000]/90 backdrop-blur-md hidden flex flex-col items-center justify-center font-mono">
                        <div class="w-full max-w-md p-6 rounded-xl border border-white/10 bg-white/5 shadow-2xl relative overflow-hidden">
                            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-violet-500 to-transparent animate-scan opacity-70"></div>
                            <div class="flex items-center gap-3 mb-6 border-b border-white/5 pb-4"><div class="w-2 h-2 rounded-full bg-slate-500"></div><div class="w-2 h-2 rounded-full bg-slate-500"></div><span class="ml-auto text-[10px] text-violet-400 font-bold tracking-widest">FLUX/KONTEXT ENGINE ACTIVATED...</span></div>
                            <div id="terminal-content" class="text-xs text-slate-300 space-y-2 h-32 overflow-hidden scroll-smooth"></div>
                            <div class="mt-4 border-t border-white/5 pt-3"><div class="w-full bg-white/5 h-1 rounded-full overflow-hidden"><div id="term-progress-bar" class="h-full bg-violet-500 w-0 transition-all duration-300"></div></div></div>
                        </div>
                    </div>
                    
                    <div id="placeholder-state" class="text-center p-24 border border-dashed border-violet-500/50 rounded-2xl bg-white/[0.01] hover:bg-white/[0.02] transition-all duration-500 animate-float backdrop-blur-sm">
                        <div class="w-20 h-20 bg-gradient-to-tr from-slate-800 to-slate-700 rounded-full flex items-center justify-center mx-auto mb-6 shadow-inner border border-white/5"><svg class="w-10 h-10 text-violet-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l-1.586-1.586a2 2 0 00-2.828 0L6 18H4a2 2 0 01-2-2V6a2 2 0 01-2-2V6a2 2 0 012-2h16a2 2 0 012 2v8a2 2 0 01-2 2h-2m-4-4l-3 3m0 0l-3-3m3 3V4"></path></svg></div>
                        <h3 class="text-2xl font-bold text-violet-500 tracking-tight mb-2">PH·ª§C H·ªíI ·∫¢NH</h3>
                        <p class="text-xs text-slate-500 font-medium uppercase tracking-widest">K√©o th·∫£ ho·∫∑c D√°n ·∫£nh v√†o ƒë√¢y</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="admin-modal" class="fixed inset-0 z-[10002] bg-black/90 backdrop-blur-md hidden flex items-center justify-center modal-fade-in overflow-y-auto">
        <div class="w-[450px] glass-panel rounded-xl border border-white/10 shadow-2xl p-6 relative my-10">
            <button id="close-admin" class="absolute top-4 right-4 text-slate-400 hover:text-white"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>
            <div id="admin-login-view">
                <div class="mb-6 text-center">
                    <h2 class="text-lg font-bold text-slate-200 tracking-widest mb-1">C·∫§U H√åNH API</h2>
                    <p class="text-[10px] text-slate-500">ƒêƒÉng nh·∫≠p ƒë·ªÉ l∆∞u API KEY vƒ©nh vi·ªÖn</p>
                </div>
                <div class="space-y-4">
                    <input type="password" id="admin-password" class="pro-input w-full py-3 text-center tracking-widest" placeholder="M·∫≠t kh·∫©u (Default: 0352803379)">
                    <button id="btn-admin-login" class="w-full py-3 bg-violet-600 hover:bg-violet-500 text-white rounded text-xs font-bold transition-colors shadow-lg">ƒêƒÇNG NH·∫¨P</button>
                </div>
            </div>
            <div id="admin-dashboard-view" class="hidden">
                 <h2 class="text-sm font-bold text-green-400 tracking-widest mb-4">SYSTEM SETTINGS</h2>
                 <div class="space-y-3">
                     <label class="text-[10px] font-bold text-slate-400 uppercase mb-1 block">API Key (Google Gemini)</label>
                     <input type="password" id="modal-api-key" class="pro-input w-full py-2 text-center tracking-widest font-mono text-violet-300" placeholder="sk-...">
                     <button id="btn-save-login" class="w-full py-2 bg-violet-600 hover:bg-violet-500 text-white rounded text-xs font-bold transition-colors shadow-lg mt-2">L∆ØU C·∫§U H√åNH</button>
                 </div>
            </div>
        </div>
    </div>

    <script>
        // --- 1. CONFIGURATION ---
        const hardcodedApiKey = ""; // B·∫†N C√ì TH·ªÇ ƒêI·ªÄN API KEY C·ª®NG V√ÄO ƒê√ÇY N·∫æU KH√îNG MU·ªêN NH·∫¨P L·∫†I (NGUY HI·ªÇM KHI PUBLIC)
        
        document.addEventListener('DOMContentLoaded', () => {
            // --- 2. USER SYSTEM & IP FALLBACK ---
            const UserSystem = {
                deviceId: null,
                credits: 20,
                ipAddress: null, 
                
                async init() {
                    let storedId = localStorage.getItem('v35_unique_device_id');
                    if (!storedId) {
                        const randomPart = Math.random().toString(36).substring(2, 8).toUpperCase();
                        storedId = `ID-${randomPart}`;
                        localStorage.setItem('v35_unique_device_id', storedId);
                    }
                    this.deviceId = storedId;
                    
                    // Fallback IP Fetch (Tr√°nh l·ªói tr√™n GitHub Pages)
                    try {
                        const response = await fetch(`https://api.ipify.org?format=json&t=${Date.now()}`);
                        if(!response.ok) throw new Error("NetErr");
                        const data = await response.json();
                        this.ipAddress = data.ip;
                    } catch (e) {
                        console.warn("IP Fetch failed, using Virtual ID");
                        this.ipAddress = "Virtual-IP-" + Math.floor(Math.random()*999);
                    }
                    this.updateUI();
                },

                updateUI() {
                    const gateIpDisplay = document.getElementById('gate-ip-display');
                    const gateLoader = document.getElementById('gate-loading-spinner');
                    const gateBtn = document.getElementById('gate-submit');
                    const gateStatus = document.getElementById('gate-status');
                    const topBarIp = document.getElementById('top-bar-ip');

                    if (topBarIp) topBarIp.textContent = `IP: ${this.ipAddress}`;

                    if (gateIpDisplay) {
                        gateIpDisplay.innerHTML = `<span class="text-slate-400 text-xs">${this.ipAddress}</span> | <span class="text-yellow-400 font-bold">${this.deviceId}</span>`; 
                        gateIpDisplay.classList.remove('shimmer-text');
                        if(gateLoader) gateLoader.style.display = 'none';
                        if(gateBtn) {
                            gateBtn.disabled = false;
                            gateBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                            gateStatus.textContent = `ƒê√£ nh·∫≠n di·ªán: ${this.deviceId}`;
                            gateStatus.classList.add('text-green-500');
                        }
                    }
                    
                    // Load saved key if exists
                    const savedKey = localStorage.getItem('v35_api_key');
                    if(savedKey) {
                        document.getElementById('user-api-key').value = savedKey;
                        document.getElementById('modal-api-key').value = savedKey;
                    }
                },
                
                deductCredits(amount) {
                    if (this.credits >= amount) { this.credits -= amount; document.getElementById('credit-count').textContent = this.credits; return true; }
                    return false;
                }
            };
            UserSystem.init();

            // --- 3. STATE & HELPERS ---
            let state = { base64: null, restoredObj: null, originalImg: null, zoom: 1 };

            const showToast = (message, type = 'info') => {
                const container = document.getElementById('toast-container');
                const toast = document.createElement('div');
                let colors = 'bg-slate-800/90 border-slate-600/30 text-white';
                if(type==='error') colors='bg-red-900/90 border-red-500/30 text-red-100';
                else if(type==='success') colors='bg-emerald-900/90 border-emerald-500/30 text-emerald-100';
                toast.className = `flex items-center gap-4 px-5 py-4 rounded-xl border backdrop-blur-md shadow-2xl animate-toast-in ${colors}`;
                toast.innerHTML = `<span class="text-xs font-bold tracking-wide">${message}</span>`;
                container.appendChild(toast);
                setTimeout(() => { toast.classList.add('animate-fade-out'); setTimeout(() => toast.remove(), 500); }, 3000);
            };

            // --- 4. LOGIC HANDLERS ---
            const gateScreen = document.getElementById('security-gate');
            document.getElementById('gate-submit').addEventListener('click', () => {
                gateScreen.classList.add('animate-fade-out');
                setTimeout(() => { gateScreen.style.display = 'none'; }, 500);
            });

            // Handle API Key Save
            const saveKeyBtn = document.getElementById('btn-save-login');
            if(saveKeyBtn) saveKeyBtn.addEventListener('click', () => {
                const key = document.getElementById('modal-api-key').value.trim();
                if(key) {
                    localStorage.setItem('v35_api_key', key);
                    document.getElementById('user-api-key').value = key;
                    showToast("ƒê√£ l∆∞u API Key th√†nh c√¥ng!", "success");
                    document.getElementById('admin-modal').classList.add('hidden');
                }
            });

            // Toggle Admin Modal
            document.getElementById('gate-admin-key').addEventListener('click', (e) => { e.stopPropagation(); document.getElementById('admin-modal').classList.remove('hidden'); document.getElementById('admin-login-view').classList.remove('hidden'); document.getElementById('admin-dashboard-view').classList.add('hidden'); });
            document.getElementById('close-admin').addEventListener('click', () => document.getElementById('admin-modal').classList.add('hidden'));
            
            // Admin Login Logic
            document.getElementById('btn-admin-login').addEventListener('click', () => {
                const pass = document.getElementById('admin-password').value;
                if(pass === '0352803379') {
                    document.getElementById('admin-login-view').classList.add('hidden');
                    document.getElementById('admin-dashboard-view').classList.remove('hidden');
                } else { showToast("Sai m·∫≠t kh·∫©u!", "error"); }
            });

            // Modules Toggle
            const toggleModule = (btnId, contentId, iconId) => {
                const btn = document.getElementById(btnId), content = document.getElementById(contentId), icon = document.getElementById(iconId);
                if(btn) btn.addEventListener('click', () => {
                    content.classList.toggle('open');
                    if(icon) icon.style.transform = content.classList.contains('open') ? 'rotate(180deg)' : 'rotate(0deg)';
                });
            };
            toggleModule('toggle-prompt', 'content-prompt', 'icon-prompt');
            toggleModule('toggle-military', 'content-military', 'icon-military');

            // Image Upload
            const resizeImage = (base64Str, maxWidth = 1024) => {
                return new Promise((resolve) => {
                    const img = new Image(); img.src = base64Str;
                    img.onload = () => {
                        let width = img.width, height = img.height;
                        if (width > maxWidth || height > maxWidth) {
                            if (width > height) { height *= maxWidth / width; width = maxWidth; } 
                            else { width *= maxWidth / height; height = maxWidth; }
                        }
                        const canvas = document.createElement('canvas'); canvas.width = width; canvas.height = height;
                        const ctx = canvas.getContext('2d'); ctx.drawImage(img, 0, 0, width, height);
                        resolve(canvas.toDataURL('image/jpeg', 0.8)); // Reduce quality for speed
                    };
                });
            };

            const loadImg = (file) => {
                if (!file || !file.type.startsWith('image/')) return showToast("Ch·ªâ h·ªó tr·ª£ file ·∫£nh!", "error");
                const reader = new FileReader();
                reader.onload = (e) => {
                    state.base64 = e.target.result;
                    document.getElementById('img-original').src = state.base64;
                    document.getElementById('comparison-view').style.display = 'flex';
                    document.getElementById('placeholder-state').style.display = 'none';
                    document.getElementById('download-trigger').disabled = true;
                };
                reader.readAsDataURL(file);
            };
            document.getElementById('image-upload').addEventListener('change', (e) => { if (e.target.files.length > 0) loadImg(e.target.files[0]); });
            
            // Slider Logic
            const sliderHandle = document.getElementById('slider-handle');
            const imgModWrapper = document.getElementById('img-modified-wrapper');
            const compInner = document.getElementById('comp-inner');
            if(compInner) {
                compInner.addEventListener('mousemove', (e) => {
                     const rect = compInner.getBoundingClientRect();
                     const x = e.clientX - rect.left;
                     const percent = Math.max(0, Math.min(100, (x / rect.width) * 100));
                     if(imgModWrapper) imgModWrapper.style.width = percent + '%';
                     if(sliderHandle) sliderHandle.style.left = percent + '%';
                });
            }

            // --- 5. MAIN LOGIC: GENERATE WITH ERROR HANDLING ---
            const processBtn = document.getElementById('process-image');
            processBtn.addEventListener('click', async () => {
                if(!state.base64) return showToast("Vui l√≤ng t·∫£i ·∫£nh!", "error");
                
                // GET KEY PRIORITY: Input User -> LocalStorage -> Hardcoded
                const userKey = document.getElementById('user-api-key').value.trim();
                const keyToUse = userKey || localStorage.getItem('v35_api_key') || hardcodedApiKey;

                if(!keyToUse) {
                    showToast("‚ö†Ô∏è L·ªñI: CH∆ØA NH·∫¨P API KEY!", "error");
                    document.getElementById('module-prompt').classList.add('open'); // M·ªü m·ª•c nh·∫≠p key
                    document.getElementById('user-api-key').focus();
                    return;
                }

                if (!UserSystem.deductCredits(20)) return showToast("H·∫øt Credits (Demo: Refresh ƒë·ªÉ reset)", "error");
                
                processBtn.disabled = true;
                processBtn.innerHTML = "ƒêANG K·∫æT N·ªêI API...";
                document.getElementById('ai-terminal-overlay').classList.remove('hidden');
                document.getElementById('scan-beam').classList.add('active');

                // Terminal Effect
                const termContent = document.getElementById('terminal-content');
                termContent.innerHTML = "";
                const steps = ["CONNECTING TO GOOGLE AI...", "UPLOADING IMAGE...", "PROCESSING...", "FINALIZING..."];
                let stepIdx = 0;
                const termInterval = setInterval(() => {
                    if(stepIdx < steps.length) { termContent.innerHTML += `<div class='text-violet-300'>${steps[stepIdx]}</div>`; stepIdx++; }
                }, 800);

                try {
                    const resizedBase64 = await resizeImage(state.base64);
                    const promptText = document.getElementById('prompt-main').value || "Restore this old photo, remove scratches, high resolution, realistic skin texture";
                    
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${keyToUse}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{
                                parts: [
                                    { text: `${promptText}. Negative prompt: blur, noise, painting, cartoon.` },
                                    { inlineData: { mimeType: "image/jpeg", data: resizedBase64.split(',')[1] } }
                                ]
                            }],
                            generationConfig: { responseModalities: ["IMAGE"] }
                        })
                    });
                    
                    if(!response.ok) {
                        const errData = await response.json();
                        throw new Error(errData.error?.message || `HTTP Error: ${response.status}`);
                    }

                    const data = await response.json();
                    let base64Img = data.candidates?.[0]?.content?.parts?.[0]?.inlineData?.data;
                    
                    if(base64Img) {
                        const finalImgSrc = `data:image/jpeg;base64,${base64Img}`;
                        state.restoredObj = new Image();
                        state.restoredObj.src = finalImgSrc;
                        state.restoredObj.onload = () => {
                            document.getElementById('img-modified').src = finalImgSrc;
                            document.getElementById('img-modified-wrapper').style.width = '50%';
                            document.getElementById('slider-handle').style.left = '50%';
                            document.getElementById('download-trigger').disabled = false;
                            document.getElementById('download-trigger').classList.remove('opacity-50', 'cursor-not-allowed');
                            showToast("X·ª≠ l√Ω th√†nh c√¥ng!", "success");
                        };
                    } else { throw new Error("API kh√¥ng tr·∫£ v·ªÅ ·∫£nh."); }

                } catch(e) {
                    console.error(e);
                    showToast(`L·ªói: ${e.message}`, "error");
                    termContent.innerHTML += `<div class='text-red-500'>ERROR: ${e.message}</div>`;
                } finally {
                    clearInterval(termInterval);
                    processBtn.disabled = false;
                    processBtn.innerHTML = "T·∫†O ·∫¢NH (FLUX KONTEXT)";
                    document.getElementById('ai-terminal-overlay').classList.add('hidden');
                    document.getElementById('scan-beam').classList.remove('active');
                }
            });

            // Download
            document.getElementById('download-trigger').addEventListener('click', () => {
                const link = document.createElement('a');
                link.download = `V35-Restore-${Date.now()}.png`;
                link.href = document.getElementById('img-modified').src;
                link.click();
            });
            
            document.getElementById('reset-button').addEventListener('click', () => window.location.reload());
        });
    </script>
</body>
</html>